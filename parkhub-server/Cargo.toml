[package]
name = "parkhub-server"
description = "ParkHub Server - Database and API server with LAN autodiscovery"
version.workspace = true
edition.workspace = true
authors.workspace = true
license.workspace = true
repository.workspace = true

[[bin]]
name = "parkhub-server"
path = "src/main.rs"

[dependencies]
parkhub-common.workspace = true

# Async runtime
tokio.workspace = true

# Database - Pure Rust embedded with app-level encryption
redb.workspace = true
aes-gcm.workspace = true
pbkdf2.workspace = true
sha2.workspace = true
rand.workspace = true
zeroize.workspace = true
hex = "0.4"

# HTTP API
axum.workspace = true
tower.workspace = true
tower-http.workspace = true

# Serialization
serde.workspace = true
serde_json.workspace = true
chrono.workspace = true
uuid.workspace = true

# Security - TLS certificates
rcgen.workspace = true
rustls.workspace = true
rustls-pemfile.workspace = true
argon2 = { version = "0.5", features = ["std", "rand"] }
rand_core = { version = "0.6", features = ["getrandom"] }
axum-server = { version = "0.7", features = ["tls-rustls"] }

# Network discovery (mDNS/DNS-SD)
mdns-sd.workspace = true

# Logging
tracing.workspace = true
tracing-subscriber.workspace = true

# Error handling
thiserror.workspace = true
anyhow.workspace = true

# Config
toml = "0.8"
directories = "5"
hostname = "0.4"

# Crypto for certificate fingerprints
ring = "0.17"

# === PHASE 1: Stabilization ===
# Input validation
validator = { version = "0.18", features = ["derive"] }

# OpenAPI documentation
utoipa = { version = "5", features = ["axum_extras", "chrono", "uuid"] }
utoipa-swagger-ui = { version = "8", features = ["axum"] }

# === PHASE 2: Production Ready ===
# JWT Authentication
jsonwebtoken = "9"

# Rate limiting
tower_governor = "0.4"
governor = "0.7"

# Metrics
metrics = "0.24"
metrics-exporter-prometheus = "0.16"

# Health checks
axum-extra = { version = "0.9", features = ["typed-header"] }

# === PHASE 3: Features ===
# Background jobs (for cleanup, notifications)
tokio-cron-scheduler = "0.13"

# UI for server onboarding (optional, can be disabled)
slint = { version = "1.14", default-features = false, features = [
    "backend-winit", "renderer-femtovg", "renderer-software", "compat-1-2"
], optional = true }

# System tray support
tray-icon = { version = "0.18", optional = true }

[build-dependencies]
slint-build = { version = "1.14", optional = true }

[target.'cfg(windows)'.build-dependencies]
winres = "0.1"

[target.'cfg(windows)'.dependencies]
windows-sys = { version = "0.59", features = [
    "Win32_UI_WindowsAndMessaging",
    "Win32_Foundation",
    "Win32_UI_Shell",
    "Win32_UI_HiDpi"
] }

[features]
default = ["gui"]
gui = ["slint", "slint-build", "tray-icon"]
headless = []

[dev-dependencies]
tempfile = "3"
